<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <title>Ù‚Ù‡Ø±Ù…Ø§Ù† Ø§Ù…Ù„Ø§</title>
    <style>
        body { font-family: 'Tahoma', sans-serif; background: #f0f4f8; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #game-container { background: white; padding: 25px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; width: 350px; border: 5px solid #FF9800; position: relative; }
        #settings { background: #fff3e0; padding: 10px; border-radius: 15px; margin-bottom: 15px; font-size: 12px; display: flex; justify-content: space-around; }
        #character { font-size: 80px; margin: 10px 0; display: block; }
        #repeat-btn { background: #FF5722; color: white; border: none; width: 55px; height: 55px; border-radius: 50%; font-size: 22px; cursor: pointer; margin-bottom: 15px; box-shadow: 0 4px 0 #e64a19; }
        .word-btn { background: #4CAF50; color: white; border: none; padding: 16px; margin: 8px 0; font-size: 22px; border-radius: 18px; cursor: pointer; width: 100%; box-shadow: 0 6px 0 #2E7D32; transition: 0.1s; outline: none; }
        .word-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #2E7D32; }
        #score-display { font-size: 22px; color: #E91E63; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="settings">
        <label><input type="checkbox" id="mute-sfx" checked> ØµØ¯Ø§ÛŒ ØªØ´ÙˆÛŒÙ‚</label>
        <label><input type="checkbox" id="mute-voice" checked> ØªÙ„ÙØ¸ Ø®ÙˆØ¯Ú©Ø§Ø±</label>
    </div>
    <div id="score-display">Ø§Ù…ØªÛŒØ§Ø²: <span id="score">0</span></div>
    <div id="character">ğŸ˜Š</div>
    <button id="repeat-btn" onclick="speakCurrent()">ğŸ”Š</button>
    <div id="options">
        <button class="word-btn" id="opt1" onclick="handleSelect(this)"></button>
        <button class="word-btn" id="opt2" onclick="handleSelect(this)"></button>
    </div>
</div>

<script>
    const sndCorrect = new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3');
    const sndWrong = new Audio('https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3');

    // Ø¨Ø§Ù†Ú© Ú©Ù„Ù…Ø§Øª (Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú©Ù„Ù…Ø§Øª Ø±Ø§ ØªØ§ 1000 Ù…ÙˆØ±Ø¯ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ú¯Ø³ØªØ±Ø´ Ø¯Ù‡ÛŒØ¯)
    const words = [
        {r:"ØµØ§Ø¨ÙˆÙ†", w:"Ø³Ø§Ø¨ÙˆÙ†"}, {r:"Ø­ÛŒØ§Ø·", w:"Ø­ÛŒØ§Øª"}, {r:"Ù‚ÙˆØ±Ø¨Ø§ØºÙ‡", w:"ØºÙˆØ±Ø¨Ø§ØºÙ‡"}, {r:"Ø·Ù†Ø§Ø¨", w:"ØªÙ†Ø§Ø¨"},
        {r:"Ø®ÙˆØ±Ø´ÛŒØ¯", w:"Ø®ÙØ±Ø´ÛŒØ¯"}, {r:"Ø¹ÛŒÙ†Ú©", w:"Ø§ÛŒÙ†Ú©"}, {r:"Ø°Ø±Øª", w:"Ø²Ø±Øª"}, {r:"Ø«Ø§Ù†ÛŒÙ‡", w:"Ø³Ø§Ù†ÛŒÙ‡"},
        {r:"ØªÙ…ÛŒØ²", w:"Ø·Ù…ÛŒØ²"}, {r:"Ø®ÙˆØ§Ø¨", w:"Ø®ÙˆØ§Ø¨"}, {r:"Ø®ÙˆØ§Ù‡Ø±", w:"Ø®Ø§Ù‡Ø±"}, {r:"ØµØ¯Ø§", w:"Ø³Ø¯Ø§"},
        {r:"Ù…Ø±Øº", w:"Ù…ÙˆØ±Øº"}, {r:"ØµØ¨Ø­", w:"Ø³Ø¨Ø­"}, {r:"Ù„Ø·Ù", w:"Ù„ØªÙ"}, {r:"Ø­ÙˆØ¶", w:"Ù‡ÙˆØ¶"},
        {r:"ØªØµÙ…ÛŒÙ…", w:"ØªØ³Ù…ÛŒÙ…"}, {r:"Ø¹Ø²ÛŒØ²", w:"Ø§Ø²ÛŒØ²"}, {r:"Ø³Ø§Ø¹Øª", w:"ØµØ§Ø¹Øª"}, {r:"Ù‚Ø·Ø±Ù‡", w:"Ù‚ØªØ±Ù‡"},
        {r:"Ù…Ø®ØµÙˆØµ", w:"Ù…Ø®ØµÙˆØ³"}, {r:"Ø§Ù…ØªØ­Ø§Ù†", w:"Ø§Ù…ØªØ®Ø§Ù†"}, {r:"Ø§Ø°ÛŒØª", w:"Ø§Ø²ÛŒØª"}, {r:"Ú©Ø«ÛŒÙ", w:"Ú©ØµÛŒÙ"},
        {r:"Ø¶Ø±Ø±", w:"Ø²Ø±Ø±"}, {r:"Ø¨Ø§Ø¹Ø«", w:"Ø¨Ø§Ø¹Ø«"}, {r:"Ù†Ù‚Ø·Ù‡", w:"Ù†Ù‚ØªÙ‡"}, {r:"Ø­ÙˆÙ„Ù‡", w:"Ù‡ÙˆÙ„Ù‡"},
        {r:"Ø´Ø¬Ø§Ø¹", w:"Ø´Ø¬Ø§"}, {r:"Ø¹Ø³Ù„", w:"Ø§Ø³Ù„"}, {r:"ØºØµÙ‡", w:"Ù‚ØµÙ‡"}, {r:"ØµÙ†Ø¯Ù„ÛŒ", w:"Ø³Ù†Ø¯Ù„ÛŒ"},
        {r:"ØªØ³Ø¨ÛŒØ­", w:"ØªØµØ¨ÛŒØ­"}, {r:"Ø¶Ù…ÛŒØ±", w:"Ø²Ù…ÛŒØ±"}, {r:"Ø­ÛŒÙˆØ§Ù†", w:"Ù‡ÛŒÙˆØ§Ù†"}, {r:"Ø®ÙˆØ´Ø­Ø§Ù„", w:"Ø®Ø´Ù‡Ø§Ù„"}
    ];

    let score = 0;
    let currentPair = {};
    let wrongQueue = [];

    function speakCurrent() {
        if (!document.getElementById('mute-voice').checked) return;
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(currentPair.r);
        msg.lang = 'fa-IR';
        msg.rate = 0.7;
        window.speechSynthesis.speak(msg);
    }

    function initRound() {
        if (wrongQueue.length > 0 && Math.random() > 0.6) {
            currentPair = wrongQueue.shift();
        } else {
            currentPair = words[Math.floor(Math.random() * words.length)];
        }
        const flip = Math.random() > 0.5;
        document.getElementById('opt1').innerText = flip ? currentPair.r : currentPair.w;
        document.getElementById('opt2').innerText = flip ? currentPair.w : currentPair.r;
        document.getElementById('character').innerText = "ğŸ¤”";
        setTimeout(speakCurrent, 300);
    }

    function handleSelect(btn) {
        if (btn.innerText === currentPair.r) {
            score += 10;
            document.getElementById('character').innerText = "ğŸ¤©";
            if(document.getElementById('mute-sfx').checked) sndCorrect.play();
        } else {
            score = Math.max(0, score - 5);
            document.getElementById('character').innerText = "ğŸ˜Ÿ";
            if(document.getElementById('mute-sfx').checked) sndWrong.play();
            if (!currentPair.count) currentPair.count = 0;
            if (currentPair.count < 3) { currentPair.count++; wrongQueue.push({...currentPair}); }
        }
        document.getElementById('score').innerText = score;
        setTimeout(initRound, 1000);
    }

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').then(() => console.log("PWA Active"));
    }
    
    // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø§ÙˆÙ„ÛŒÙ† Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯Ù† ØµØ¯Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±
    window.onclick = () => { if(!currentPair.r) initRound(); };
    initRound();
</script>
</body>
</html>
